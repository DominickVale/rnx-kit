"use strict";(self.webpackChunk_rnx_kit_docsite=self.webpackChunk_rnx_kit_docsite||[]).push([[1136],{517:function(e,n,t){t.d(n,{Z:function(){return r}});var a=t(7378);function r(e){var n=e.children,t=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:t,className:r},n)}},637:function(e,n,t){t.d(n,{Z:function(){return p}});var a=t(5773),r=t(7378),i=t(6457),o=t(1309),l=t(8944),s="tabItem_WhCL";function u(e){var n,t,i,u=e.lazy,p=e.block,d=e.defaultValue,c=e.values,m=e.groupId,h=e.className,g=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),k=null!=c?c:g.map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes}})),f=(0,o.lx)(k,(function(e,n){return e.value===n.value}));if(f.length>0)throw new Error('Docusaurus error: Duplicate values "'+f.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var v=null===d?d:null!=(n=null!=d?d:null==(t=g.find((function(e){return e.props.default})))?void 0:t.props.value)?n:null==(i=g[0])?void 0:i.props.value;if(null!==v&&!k.some((function(e){return e.value===v})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+k.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var b=(0,o.UB)(),y=b.tabGroupChoices,N=b.setTabGroupChoices,w=(0,r.useState)(v),x=w[0],T=w[1],C=[],M=(0,o.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var j=y[m];null!=j&&j!==x&&k.some((function(e){return e.value===j}))&&T(j)}var Z=function(e){var n=e.currentTarget,t=C.indexOf(n),a=k[t].value;a!==x&&(M(n),T(a),null!=m&&N(m,a))},D=function(e){var n,t=null;switch(e.key){case"ArrowRight":var a=C.indexOf(e.currentTarget)+1;t=C[a]||C[0];break;case"ArrowLeft":var r=C.indexOf(e.currentTarget)-1;t=C[r]||C[C.length-1]}null==(n=t)||n.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":p},h)},k.map((function(e){var n=e.value,t=e.label,i=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:x===n?0:-1,"aria-selected":x===n,key:n,ref:function(e){return C.push(e)},onKeyDown:D,onFocus:Z,onClick:Z},i,{className:(0,l.Z)("tabs__item",s,null==i?void 0:i.className,{"tabs__item--active":x===n})}),null!=t?t:n)}))),u?(0,r.cloneElement)(g.filter((function(e){return e.props.value===x}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},g.map((function(e,n){return(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==x})}))))}function p(e){var n=(0,i.Z)();return r.createElement(u,(0,a.Z)({key:String(n)},e))}},3842:function(e,n,t){t.d(n,{ZP:function(){return s}});var a=t(5773),r=t(808),i=(t(7378),t(5318)),o=["components"],l={toc:[]};function s(e){var n=e.components,t=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Was this helpful? Spread the word on ",(0,i.kt)("a",{parentName:"p",href:"https://twitter.com"},"Twitter"),":\n",(0,i.kt)("inlineCode",{parentName:"p"},"@ReactNativeMSFT")," ",(0,i.kt)("inlineCode",{parentName:"p"},"#rnxkit")))}s.isMDXComponent=!0},1266:function(e,n,t){t.d(n,{ZP:function(){return d}});var a=t(5773),r=t(808),i=(t(7378),t(5318)),o=t(637),l=t(517),s=t(1789),u=["components"],p={toc:[]};function d(e){var n=e.components,t=(0,r.Z)(e,u);return(0,i.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)(o.Z,{groupId:"package-manager",mdxType:"Tabs"},(0,i.kt)(l.Z,{value:"yarn",label:"Yarn",default:!0,mdxType:"TabItem"},(0,i.kt)(s.Z,{language:"sh",mdxType:"CodeBlock"},"yarn ",t.yarnArgs||t.args)),(0,i.kt)(l.Z,{value:"pnpm",label:"pnpm",mdxType:"TabItem"},(0,i.kt)(s.Z,{language:"sh",mdxType:"CodeBlock"},"pnpm ",t.pnpmArgs||t.args)),(0,i.kt)(l.Z,{value:"npm",label:"npm",mdxType:"TabItem"},(0,i.kt)(s.Z,{language:"sh",mdxType:"CodeBlock"},"npm ",t.npmArgs||t.args))))}d.isMDXComponent=!0},4597:function(e,n,t){t.d(n,{ZP:function(){return d}});var a=t(5773),r=t(808),i=(t(7378),t(5318)),o=t(637),l=t(517),s=t(1789),u=["components"],p={toc:[]};function d(e){var n=e.components,t=(0,r.Z)(e,u);return(0,i.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)(o.Z,{groupId:"package-manager",mdxType:"Tabs"},(0,i.kt)(l.Z,{value:"yarn",label:"Yarn",default:!0,mdxType:"TabItem"},(0,i.kt)(s.Z,{language:"sh",mdxType:"CodeBlock"},"yarn ",t.yarnArgs||t.args)),(0,i.kt)(l.Z,{value:"pnpm",label:"pnpm",mdxType:"TabItem"},(0,i.kt)(s.Z,{language:"sh",mdxType:"CodeBlock"},"pnpm ",t.pnpmArgs||t.args)),(0,i.kt)(l.Z,{value:"npm",label:"npm",mdxType:"TabItem"},(0,i.kt)(s.Z,{language:"sh",mdxType:"CodeBlock"},"npx ",t.npxArgs||t.args))))}d.isMDXComponent=!0},914:function(e,n,t){t.r(n),t.d(n,{assets:function(){return m},contentTitle:function(){return d},default:function(){return k},frontMatter:function(){return p},metadata:function(){return c},toc:function(){return h}});var a=t(5773),r=t(808),i=(t(7378),t(5318)),o=t(1266),l=t(4597),s=t(3842),u=["components"],p={},d="Bundling",c={unversionedId:"guides/bundling",id:"guides/bundling",title:"Bundling",description:"When you're done here, you'll be able to bundle and ship your apps with Metro,",source:"@site/docs/guides/bundling.mdx",sourceDirName:"guides",slug:"/guides/bundling",permalink:"/rnx-kit/docs/guides/bundling",editUrl:"https://github.com/microsoft/rnx-kit/tree/main/docsite/docs/guides/bundling.mdx",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Dependency Management",permalink:"/rnx-kit/docs/guides/dependency-management"}},m={},h=[{value:"Setting up the Tools",id:"setting-up-the-tools",level:2},{value:"Configuring Your App",id:"configuring-your-app",level:2},{value:"Running the Bundler",id:"running-the-bundler",level:2},{value:"Integrating With PRs and Builds",id:"integrating-with-prs-and-builds",level:2},{value:"Enhancing the Bundler",id:"enhancing-the-bundler",level:2},{value:"Type Safety",id:"type-safety",level:3},{value:"Tree Shaking",id:"tree-shaking",level:3},{value:"Duplicate Dependencies",id:"duplicate-dependencies",level:3},{value:"Cyclic Dependencies",id:"cyclic-dependencies",level:3},{value:"Running the Bundle Server",id:"running-the-bundle-server",level:2},{value:"Wrapping Up",id:"wrapping-up",level:2}],g={toc:h};function k(e){var n=e.components,t=(0,r.Z)(e,u);return(0,i.kt)("wrapper",(0,a.Z)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"bundling"},"Bundling"),(0,i.kt)("p",null,"When you're done here, you'll be able to bundle and ship your apps with Metro,\nthe React Native bundler. The tools you'll use in this guide ",(0,i.kt)("em",{parentName:"p"},"enhance")," Metro,\nmaking it easier to use, type-safe, and fast."),(0,i.kt)("p",null,"This guide is meant to be used with one React Native app at a time, though you\ncan repeat it for all of your apps."),(0,i.kt)("h2",{id:"setting-up-the-tools"},"Setting up the Tools"),(0,i.kt)("p",null,"Install the tools you'll need for bundling."),(0,i.kt)(o.ZP,{yarnArgs:"add @rnx-kit/cli @rnx-kit/babel-preset-metro-react-native @rnx-kit/metro-config @rnx-kit/metro-resolver-symlinks --dev",pnpmArgs:"add -D @rnx-kit/cli @rnx-kit/babel-preset-metro-react-native @rnx-kit/metro-config @rnx-kit/metro-resolver-symlinks",npmArgs:"add --save-dev @rnx-kit/cli @rnx-kit/babel-preset-metro-react-native @rnx-kit/metro-config @rnx-kit/metro-resolver-symlinks",mdxType:"PackageCommand"}),(0,i.kt)("p",null,"Add ",(0,i.kt)("inlineCode",{parentName:"p"},"@rnx-kit/babel-preset-metro-react-native")," as a preset in your Babel\nconfiguration:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="babel.config.js"',title:'"babel.config.js"'},'module.exports = {\n  presets: ["@rnx-kit/babel-preset-metro-react-native"],\n};\n')),(0,i.kt)("p",null,"Update your Metro configuration, using ",(0,i.kt)("inlineCode",{parentName:"p"},"@rnx-kit/metro-config")," to create the\nbaseline config. Add support for symlinks, too, which all major package managers\n(Yarn, pnpm, npm) use today."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="metro.config.js"',title:'"metro.config.js"'},'const { makeMetroConfig } = require("@rnx-kit/metro-config");\nconst MetroSymlinksResolver = require("@rnx-kit/metro-resolver-symlinks");\n\nmodule.exports = makeMetroConfig({\n  resolver: {\n    resolveRequest: MetroSymlinksResolver(),\n  },\n  // Add your existing Metro configuration here! It will be merged in.\n});\n')),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If you were using Metro before, you probably have some mappings in place which\nwork around the fact that Metro doesn't support symlinks. You can get rid of all\nthat now! \ud83c\udf89"))),(0,i.kt)("h2",{id:"configuring-your-app"},"Configuring Your App"),(0,i.kt)("p",null,"Configure your app for bundling from the command-line:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json"',title:'"package.json"'},'{\n  "rnx-kit": {\n    "bundle": true\n  }\n}\n')),(0,i.kt)("p",null,"This turns on bundling using a default configuration. The\n",(0,i.kt)("a",{parentName:"p",href:"../tools/config#schema"},"config schema")," shows all properties and their defaults."),(0,i.kt)("p",null,"Chances are you've already got a working bundler for your app. Maybe it's Metro,\nor maybe it's Haul or Re.Pack. You have valuable information encoded in config\nfiles and command-lines that needs to be preserved."),(0,i.kt)("p",null,"You might have a ",(0,i.kt)("inlineCode",{parentName:"p"},"bundle")," script command in package.json that looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'react-native bundle \\\n  --entry-file ./index.js \\\n  --platform ios \\\n  --dev false \\\n  --bundle-output ./dist/app-metro.ios.jsbundle \\\n  --sourcemap-output ./dist/app-metro.ios.map"\n')),(0,i.kt)("p",null,"Good news! Nearly all ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native bundle")," command-line options can be set in\nyour ",(0,i.kt)("inlineCode",{parentName:"p"},"rnx-kit")," bundle config. Take a look at the\n",(0,i.kt)("a",{parentName:"p",href:"../tools/config#schema"},"config schema")," to see what's available."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json with an updated script command and bundle config"',title:'"package.json',with:!0,an:!0,updated:!0,script:!0,command:!0,and:!0,bundle:!0,'config"':!0},'{\n  "scripts": {\n    "bundle": "react-native rnx-bundle --dev false"\n  },\n  "rnx-kit": {\n    "bundle": {\n      "entryPath": "./index.js",\n      "bundlePrefix": "app-metro",\n      "targets": ["ios"],\n      "platforms": {\n        "ios": {\n          "sourceMapPath": "app-metro.ios.map"\n        }\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",null,'Maybe you are using Haul? Haul configuration is complex and may be hard to\n"port" to ',(0,i.kt)("inlineCode",{parentName:"p"},"rnx-kit")," bundle config. After all, Metro doesn't support everything\nHaul does, most notably Webpack plugins."),(0,i.kt)("p",null,"Review your Haul configuration and command-line scripts. Compare it to the\n",(0,i.kt)("a",{parentName:"p",href:"../tools/config#schema"},"config schema"),", mapping what fits."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Need a missing feature?")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If you need a bundling feature that isn't supported, please make your voice\nheard! \ud83d\udcac You can\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/microsoft/rnx-kit/issues/new?title=Bundling%20Feature%20Request&body=%3c%21--%20Describe%20the%20feature%20your%20need%20here.%20--%3e%0a%0a"},"create an ",(0,i.kt)("strong",{parentName:"a"},"issue")),"\nor even ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/microsoft/rnx-kit"},"submit a ",(0,i.kt)("strong",{parentName:"a"},"pull request")),". All\n",(0,i.kt)("a",{parentName:"p",href:"../contributing"},"contributions")," are welcome!"))),(0,i.kt)("h2",{id:"running-the-bundler"},"Running the Bundler"),(0,i.kt)("p",null,"Now that your app is configured and has the right tools, you can bundle it using\nthe ",(0,i.kt)("a",{parentName:"p",href:"../tools/cli"},"CLI"),":"),(0,i.kt)(l.ZP,{args:"react-native rnx-bundle",mdxType:"PackageRunCommand"}),(0,i.kt)("p",null,'Unless you changed the output directory, the bundle file and all asset files\nwill be under the "./dist" directory.'),(0,i.kt)("p",null,"You can override parts of your configuration using command-line parameters. This\nis useful when making script command shortcuts, such as per-platform bundle\ncreation. And, there are some parameters which can only be set via the\ncommand-line, such as developer-mode and minification."),(0,i.kt)("p",null,"You can see the full list of parameters by running:"),(0,i.kt)(l.ZP,{args:"react-native rnx-bundle --help",mdxType:"PackageRunCommand"}),(0,i.kt)("h2",{id:"integrating-with-prs-and-builds"},"Integrating With PRs and Builds"),(0,i.kt)("p",null,"Add a command to each of your app packages which bundles all target platforms:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json"',title:'"package.json"'},'{\n  "scripts": {\n    "bundle": "react-native rnx-bundle --dev false"\n  }\n}\n')),(0,i.kt)("p",null,"If you use Lerna, you can run one command from the root of your repo to bundle\nall packages:"),(0,i.kt)(l.ZP,{args:"lerna run bundle",mdxType:"PackageRunCommand"}),(0,i.kt)("p",null,"If you're using a task runner like Lage or Gulp, you can go for a more\nsophisticated integration. The advantage being that ",(0,i.kt)("inlineCode",{parentName:"p"},"bundle")," runs as its own\ntask with isolated logging and error handling. And, you can run it in parallel\nwith other tasks."),(0,i.kt)("p",null,"Now that you have a top-level command figured out, add it to your top-level\npackage.json:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json"',title:'"package.json"'},'{\n  "scripts": {\n    "bundle": "lerna run bundle"\n  }\n}\n')),(0,i.kt)("p",null,"And then call that top-level command from your PR and Build CI loop definitions:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml",metastring:'title="GitHub Actions Example"',title:'"GitHub',Actions:!0,'Example"':!0},"jobs:\n  build:\n    steps:\n      - name: Bundle all packages\n        run: yarn bundle\n")),(0,i.kt)("p",null,"Easy, right? Now your PRs and Builds will protect the source tree from code that\nbreaks bundling!"),(0,i.kt)("h2",{id:"enhancing-the-bundler"},"Enhancing the Bundler"),(0,i.kt)("p",null,"Remember that bit at the start of this guide about ",(0,i.kt)("em",{parentName:"p"},"enhancing")," Metro? You've\narrived."),(0,i.kt)("h3",{id:"type-safety"},"Type Safety"),(0,i.kt)("p",null,"Let's start with ",(0,i.kt)("strong",{parentName:"p"},"type-safe bundling"),". That's right -- TypeScript validation\nin Metro. \ud83d\ude0e"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "rnx-kit": {\n    "bundle": {\n      "typescriptValidation": true\n    }\n  }\n}\n')),(0,i.kt)("p",null,'When you first turn this on, it may reveal some type errors. You can work\nthrough them now, or put them on your backlog and add a new issue to "turn on\ntype-safe bundling" as the last step.'),(0,i.kt)("p",null,"Once you have type-safe bundling enabled, developers will see type errors right\naway in their local builds. And, type errors will be kept ",(0,i.kt)("em",{parentName:"p"},"out")," of the main\nbranch because they'll fail PRs."),(0,i.kt)("h3",{id:"tree-shaking"},"Tree Shaking"),(0,i.kt)("p",null,"Next up is tree shaking, which makes your app bundle smaller by eliminating\nunused code. Some times, your app bundle gets A LOT smaller."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "rnx-kit": {\n    "bundle": {\n      "experimental_treeShake": true\n    }\n  }\n}\n')),(0,i.kt)("p",null,"This feature is marked as ",(0,i.kt)("inlineCode",{parentName:"p"},"experimental")," because it occasionally produces larger\nbundles when used with code-splitting (an internal project which hasn't shipped\nyet)."),(0,i.kt)("p",null,"Double-check that your app bundle is smaller. If you run into trouble, please\nshare what you are seeing in\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/microsoft/rnx-kit/issues/new/choose"},"a new issue"),"."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Performance Gain")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"With tree shaking, Metro will produce your app bundles faster!"),(0,i.kt)("p",{parentName:"div"},"Metro calls out to esbuild to create your tree shaken app bundle from individual\npackage files. Metro (a JavaScript application) is not nearly as fast as esbuild\n(a native application)."))),(0,i.kt)("h3",{id:"duplicate-dependencies"},"Duplicate Dependencies"),(0,i.kt)("p",null,"Duplicate dependencies can cause runtime problems. Metro won't warn you about\nthem, and tree shaking won't get rid of them."),(0,i.kt)("p",null,"Turn on the\n",(0,i.kt)("a",{parentName:"p",href:"../tools/metro-plugin-duplicates-checker"},"duplicate dependency checker"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "rnx-kit": {\n    "bundle": {\n      "detectDuplicateDependencies": true\n    }\n  }\n}\n')),(0,i.kt)("p",null,"When you first turn this on, it may reveal that you already have duplicates in\nyour app bundle. Don't panic!"),(0,i.kt)("p",null,'You can use fine-grained configuration to "live with" the duplicates you have,\nuntil they can be fixed:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "rnx-kit": {\n    "bundle": {\n      "detectDuplicateDependencies": {\n        // List each duplicate here to ignore it\n        "ignoredModules": ["react-is"],\n        "throwOnError": true\n      }\n    }\n  }\n}\n')),(0,i.kt)("h3",{id:"cyclic-dependencies"},"Cyclic Dependencies"),(0,i.kt)("p",null,'Cyclic dependencies are a "loop" in your dependency tree: logger >\nfile-appender > fs-utils > logger. Like duplicate dependencies, they, too, can\ncause runtime problems.'),(0,i.kt)("p",null,"Find them using the\n",(0,i.kt)("a",{parentName:"p",href:"../tools/metro-plugin-cyclic-dependencies-detector"},"cyclic dependency detector"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "rnx-kit": {\n    "bundle": {\n      "detectCyclicDependencies": true\n    }\n  }\n}\n')),(0,i.kt)("p",null,"After turning this on, you might discover that you already have cycles in your\ndependency tree. It's ok!"),(0,i.kt)("p",null,'Use fine-grained configuration to "live with" the cycles you have, until they\ncan be fixed.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "rnx-kit": {\n    "bundle": {\n      "detectCyclicDependencies": {\n        "includeNodeModules": false,\n        "linesOfContext": 5,\n        "throwOnError": false // Set this to true after making fixes\n      }\n    }\n  }\n}\n')),(0,i.kt)("h2",{id:"running-the-bundle-server"},"Running the Bundle Server"),(0,i.kt)("p",null,"Create a new script command in your app which runs the bundle server:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json"',title:'"package.json"'},'{\n  "scripts": {\n    "start": "react-native rnx-start"\n  }\n}\n')),(0,i.kt)("p",null,"This ",(0,i.kt)("a",{parentName:"p",href:"../tools/cli"},"CLI")," command is very similar to ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native start"),"."),(0,i.kt)("p",null,"You can see the full list of command-line parameters by running:"),(0,i.kt)(l.ZP,{args:"react-native rnx-start --help",mdxType:"PackageRunCommand"}),(0,i.kt)("p",null,"You can control default server properties for you app through configuration. For\nexample, you can enable enhancements like type-safety or duplicate dependency\ndetection."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json"',title:'"package.json"'},'{\n  "rnx-kit": {\n    "server": {\n      "detectCyclicDependencies": true,\n      "detectDuplicateDependencies": true,\n      "typescriptValidation": true\n    }\n  }\n}\n')),(0,i.kt)("p",null,"Take a look at the ",(0,i.kt)("a",{parentName:"p",href:"../tools/config#schema"},"config schema")," to see what is\navailable."),(0,i.kt)("p",null,"Command-line parameters take precedence over your app's configuration. This is\nuseful when making using specialized commands in script blocks or at your\ndevelopment terminal."),(0,i.kt)("p",null,"Once the server is running, it reports status and error messages to the terminal\nwindow. It also accepts input commands. For example, you can force the client to\nreload its bundle or open its developer menu. You can also quit the server with\n",(0,i.kt)("inlineCode",{parentName:"p"},"Control-C"),"."),(0,i.kt)("h2",{id:"wrapping-up"},"Wrapping Up"),(0,i.kt)("p",null,"You've done it! You're bundling and serving your React Native apps with Metro,\nusing ",(0,i.kt)("em",{parentName:"p"},"enhancements")," to make the process fast and safe! And your customers will\nthank you when their download size drops thanks to tree shaking!"),(0,i.kt)(s.ZP,{mdxType:"AmplifyCallout"}),(0,i.kt)("p",null,"See room for improvement? Great! ",(0,i.kt)("a",{parentName:"p",href:"/docs/contributing"},"Contribute")," your ideas in\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/microsoft/rnx-kit/issues/new/choose"},"a new issue")," or through\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/microsoft/rnx-kit/pulls"},"a pull request"),"."))}k.isMDXComponent=!0}}]);